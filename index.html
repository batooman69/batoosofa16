<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BATOO SOFA</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      background-color: #f9f9f9;
      color: #333;
    }
    header, footer {
      background: white;
      padding: 0.8rem 1.25rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 120;
    }
    header h1 {
      margin: 0;
      font-size: 1.35rem;
      color: #0070f3;
      cursor: pointer;
    }
    nav {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    nav a {
      margin-left: 12px;
      text-decoration: none;
      color: #333;
      font-weight: 500;
      transition: color 0.3s;
    }
    nav a:hover {
      color: #0070f3;
    }
    nav a.active {
      font-weight: 700;
      color: #0070f3;
    }

    /* auth buttons in header */
    .auth-controls { display:flex; gap:0.5rem; align-items:center; }
    .btn-auth {
      background: transparent;
      border: 1px solid #ddd;
      padding: 0.4rem 0.7rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    .btn-primary {
      background: #0070f3;
      color: #fff;
      border: none;
    }

    .hero {
      background-image: url("sofa.jpg");
      background-size: cover;
      background-position: center;
      height: 100vh; /* í™”ë©´ ë†’ì´ 100% */
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 2rem;
      font-weight: bold;
      position: relative;
      cursor: pointer;
      text-align: center;
      padding: 0 1rem;
    }
    .hero::before {
      content: '';
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      z-index: 0;
    }
    .hero span {
      position: relative;
      z-index: 1;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      padding: 2rem;
      min-height: 70vh;
    }
    /* ë°”íˆ¬ ì†ŒíŒŒ ì†Œê°œ ì„¹ì…˜ ì‚¬ì§„ ìŠ¤íƒ€ì¼ */
    .intro-section {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      align-items: center;
      justify-content: center;
      margin-bottom: 3rem;
    }
    .intro-text {
      flex: 1 1 320px;
      min-width: 560px;
      font-size: 2.2rem;
      line-height: 3.2;
      color: #222;
      max-width: 1000px;
    }
    .intro-image {
      flex: 1 1 1200px;
      max-width: 1200px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.15);
      border-radius: 15px;
      overflow: hidden;
    }
    .intro-image img {
      display: block;
      width: 100%;
      height: auto;
      border-radius: 15px;
    }
    /* ì œí’ˆ ì†Œê°œ */
    .products {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }
    .product {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display:flex;
      flex-direction:column;
      transition: box-shadow 0.3s;
      min-height: 480px; /* ê¸°ì¡´ 420px â†’ 480pxë¡œ ë†’ì´ ì¦ê°€ */
    }
    .product:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .product img {
      width: 100%;
      height: 280px; /* ê¸°ì¡´ 250px â†’ 280pxë¡œ ë†’ì´ ì¦ê°€ */
      object-fit: cover;
      display:block;
    }
    .product .info {
      padding: 1rem;
      flex:1;
      display:flex;
      flex-direction:column;
    }
    .product .info h4 {
      margin: 0 0 0.5rem;
      font-size: 1.25rem;
      color: #0070f3;
    }
    .product .info p {
      margin: 0 0 1rem;
      color: gray;
      font-weight:600;
      font-size: 1.1rem;
    }
    .product .info button {
      background: #0070f3;
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 5px;
      width: 100%;
      cursor:pointer;
      font-weight:600;
      font-size: 1rem;
      transition: background-color 0.3s;
      margin-top: auto;
    }
    .product .info button:hover {
      background: #005bb5;
    }
    /* ì„¹ì…˜ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    .section {
      background: #eef6ff;
      border-radius: 10px;
      padding: 1.5rem;
      margin-top: 2rem;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    input[type=email], textarea, select, input[type=text], input[type=password] {
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 0.95rem;
    }
    button.subscribe {
      background: #0070f3;
      color: white;
      border: none;
      padding: 0.5rem;
      border-radius: 5px;
      cursor:pointer;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    button.subscribe:hover {
      background: #005bb5;
    }
    footer {
      text-align: center;
      font-size: 0.875rem;
      color: gray;
      margin-top: 2rem;
      padding-bottom: 2rem;
    }
    /* ë¦¬ë·°ìš© (ìŠ¤íƒ€) */
    .stars { display:flex; gap:6px; align-items:center; }
    .star { font-size:1.6rem; cursor:pointer; color:lightgray; user-select:none; transition: color 0.3s; }
    .star.selected { color: gold; }
    .review-list { margin-top: 1rem; display:flex; flex-direction:column; gap:0.6rem; }
    .review-item { background:#fff;padding:.75rem;border-radius:8px;box-shadow:0 1px 3px rgba(0,0,0,0.04); }
    .meta{ font-size:0.85rem; color:gray; margin-bottom:0.4rem; }
    .row { display:flex; gap:1rem; align-items:center; flex-wrap:wrap; }
    .btn-ghost { background:transparent; border:1px solid #ddd; padding:.45rem .75rem; border-radius:6px; cursor:pointer; }
    /* í™ˆ ì„¹ì…˜ í˜ì´ë“œì¸ */
    .home-section {
      opacity: 0;
      transform: translateY(40px);
      transition: opacity 0.8s ease, transform 0.8s ease;
      margin-bottom: 3rem;

      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      padding: 2rem;
      box-sizing: border-box;
    }
    .home-section.visible {
      opacity: 1;
      transform: translateY(0);
    }
    @media(max-width:900px){
      .intro-section {
        flex-direction: column;
      }
      .intro-text, .intro-image {
        max-width: 100%;
      }
      .product img {
        height: 220px;
      }
      .hero{
        height: 240px;
        font-size: 1.3rem;
      }
      .product {
        min-height: 420px;
      }
      header, footer { padding-left: 0.8rem; padding-right: 0.8rem; }
    }

    /* ì†Œì…œ ë§í¬ */
    .social-links {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }
    .social-btn {
      flex: 1;
      text-align: center;
      padding: 1rem 0;
      border-radius: 8px;
      font-size: 1.2rem;
      font-weight: 600;
      color: white;
      text-decoration: none;
      user-select: none;
      transition: background-color 0.3s ease;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      min-width: 140px;
    }
    .social-btn.instagram {
      background: #E1306C; /* ì¸ìŠ¤íƒ€ê·¸ë¨ í•‘í¬ */
    }
    .social-btn.instagram:hover {
      background: #B62456;
    }
    .social-btn.blog {
      background: #03C75A; /* ë„¤ì´ë²„ ë¸”ë¡œê·¸ ê·¸ë¦° */
    }
    .social-btn.blog:hover {
      background: #029946;
    }

    /* ìœ íŠœë¸Œ ì„¹ì…˜ */
    .youtube-section {
      text-align: center;
    }
    .youtube-iframe {
      width: 100%;
      max-width: 1000px;
      height: 560px;
      border: none;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
      margin-bottom: 1rem;
    }
    .btn-youtube {
      background: #FF0000;
      color: white;
      border: none;
      padding: 0.7rem 2.2rem;
      font-size: 1.2rem;
      border-radius: 30px;
      cursor: pointer;
      font-weight: 700;
      box-shadow: 0 3px 8px rgba(255,0,0,0.6);
      transition: background-color 0.3s ease;
      user-select: none;
    }
    .btn-youtube:hover {
      background: #cc0000;
    }

    /* Modal (ë¡œê·¸ì¸/íšŒì›ê°€ì…) */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display:flex;
      align-items:center;
      justify-content:center;
      z-index: 200;
    }
    .modal {
      width: 100%;
      max-width: 480px;
      background: #fff;
      border-radius: 12px;
      padding: 1.25rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .modal h3 { margin-top: 0; }
    .modal .row { flex-direction: column; align-items:stretch; }
    .modal .actions { display:flex; gap:0.5rem; justify-content:flex-end; margin-top:0.5rem; }
    .hidden { display:none !important; }

    /* small helper */
    .small { font-size:0.85rem; color:#666; }
    .header-right { display:flex; gap:1rem; align-items:center; }
  </style>
</head>
<body>

<header>
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <h1 id="logo">BATOO SOFA</h1>
    <div style="display:flex; align-items:center; gap:1rem;">
      <nav>
        <a href="#home" class="nav-link">í™ˆ</a>
        <!-- 'ì œí’ˆ' ë²„íŠ¼ will scroll to the products section on the home page -->
        <a href="#products" id="nav-products" class="nav-link">ì œí’ˆ</a>
        <a href="#reviews" id="nav-reviews" class="nav-link">ë¦¬ë·°</a>
        <a href="#contact" class="nav-link">ì—°ë½ì²˜</a>
      </nav>

      <div class="header-right">
        <div id="authArea" class="auth-controls">
          <!-- JS will populate login/register or user info -->
          <button id="btnLogin" class="btn-auth">ë¡œê·¸ì¸</button>
          <button id="btnRegister" class="btn-auth">íšŒì›ê°€ì…</button>
        </div>
      </div>
    </div>
  </div>
</header>

<div class="hero" id="banner"><span>í¸ì•ˆí•¨ì˜ ê¸°ì¤€, BATOO</span></div>

<div class="container" id="main"></div>

<footer>
  Â© 2025 Batoo Sofa. All rights reserved.
</footer>

<!-- Modals (ë¡œê·¸ì¸ / íšŒì›ê°€ì…) -->
<div id="modalBackdrop" class="modal-backdrop hidden" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" id="authModal">
    <!-- content filled by JS -->
  </div>
</div>

<script>
  /* -----------------------------
     ë°ì´í„° / ìƒìˆ˜
     ----------------------------- */
  const PRODUCTS = {
    1: { id:1, name: "ê¾¸ì˜¤ë˜", price: "ì „í™”, ë©”ì„¸ì§€ ë¬¸ì˜", img: "kkuore.jpg", desc: "ê³ ê¸‰ ê°€ì£½ê³¼ ê²¬ê³ í•œ í”„ë ˆì„ìœ¼ë¡œ ì œì‘ëœ í´ë˜ì‹ ë¼ì¸ì˜ í”„ë¦¬ë¯¸ì—„ ì†ŒíŒŒì…ë‹ˆë‹¤. ì¥ì‹œê°„ ì‚¬ìš©ì—ë„ í¸ì•ˆí•¨ ìœ ì§€." },
    2: { id:2, name: "í”¼ì˜¤ë˜", price: "ì „í™”, ë©”ì„¸ì§€ ë¬¸ì˜", img: "fiore.jpg", desc: "ë¶€ë“œëŸ¬ìš´ íŒ¨ë¸Œë¦­ ì†Œì¬ì™€ ëª¨ë˜í•œ ë””ìì¸ì˜ ì¡°í™”. ê³µê°„ì„ ë°ê²Œ ë§Œë“œëŠ” ì»¬ëŸ¬ ì˜µì…˜ ì œê³µ." },
    3: { id:3, name: "í”¼ì˜¤ë˜-ì•„ì´ë³´ë¦¬", price: "ì „í™”, ë©”ì„¸ì§€ ë¬¸ì˜", img: "fiore_ivory.jpg", desc: "ë„“ì€ ì¢Œì„ê³¼ ê¹Šì€ ì¿ ì…˜ìœ¼ë¡œ íœ´ì‹ì„ ê·¹ëŒ€í™”í•œ ëª¨ë¸. ê°€ì¡± ëª¨ë‘ì˜ íœ´ì‹ ê³µê°„ìœ¼ë¡œ ì í•©í•©ë‹ˆë‹¤." },
    4: { id:4, name: "ë¯¸ë¼í´", price: "ì „í™”, ë©”ì„¸ì§€ ë¬¸ì˜", img: "miracle.jpg", desc: "ë¯¸ë‹ˆë©€í•œ ë¼ì¸ê³¼ ë›°ì–´ë‚œ ë‚´êµ¬ì„±ì˜ ì¡°í•©. ì„¸ë ¨ëœ ê±°ì‹¤ì„ ì™„ì„±í•´ ì¤ë‹ˆë‹¤." }
  };

  const REVIEWS_KEY = 'batoo_reviews_v1';
  const USERS_KEY = 'batoo_users_v1';
  const CURRENT_USER_KEY = 'batoo_current_user_v1';

  // variable used to request scrolling to a particular section after route renders
  let pendingScrollTo = null;

  /* -----------------------------
     ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í—¬í¼ (ë¦¬ë·°/ìœ ì €)
     ----------------------------- */
  function loadReviews() {
    try {
      return JSON.parse(localStorage.getItem(REVIEWS_KEY)) || [];
    } catch(e) {
      return [];
    }
  }

  function saveReviews(list) {
    localStorage.setItem(REVIEWS_KEY, JSON.stringify(list));
  }

  function loadUsers(){
    try { return JSON.parse(localStorage.getItem(USERS_KEY)) || []; }
    catch(e){ return []; }
  }
  function saveUsers(list){
    localStorage.setItem(USERS_KEY, JSON.stringify(list));
  }
  function setCurrentUser(user){
    if(user) localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(user));
    else localStorage.removeItem(CURRENT_USER_KEY);
    renderAuthArea();
  }
  function getCurrentUser(){
    try { return JSON.parse(localStorage.getItem(CURRENT_USER_KEY)) || null; }
    catch(e){ return null; }
  }

  /* -----------------------------
     ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ (Web Crypto API)
     ----------------------------- */
  async function hashPassword(password){
    if(!window.crypto || !crypto.subtle) {
      // fallback: not secure, but something
      return btoa(password);
    }
    const enc = new TextEncoder();
    const data = enc.encode(password);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2,'0')).join('');
  }

  /* -----------------------------
     í—¤ë”/ì¸ì¦ UI ì²˜ë¦¬
     ----------------------------- */
  const authArea = document.getElementById('authArea');
  function renderAuthArea(){
    const user = getCurrentUser();
    authArea.innerHTML = '';
    if(user){
      const nameEl = document.createElement('div');
      nameEl.className = 'small';
      nameEl.textContent = `${user.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤`;
      const btnLogout = document.createElement('button');
      btnLogout.className = 'btn-auth';
      btnLogout.textContent = 'ë¡œê·¸ì•„ì›ƒ';
      btnLogout.addEventListener('click', () => {
        setCurrentUser(null);
        alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
        handleRoute(); // re-render if necessary
      });
      const btnProfile = document.createElement('button');
      btnProfile.className = 'btn-auth btn-primary';
      btnProfile.textContent = 'ë§ˆì´í˜ì´ì§€';
      btnProfile.addEventListener('click', () => {
        // ê°„ë‹¨í•œ ë§ˆì´í˜ì´ì§€(ì£¼ë¬¸/ë¦¬ë·° ê´€ë¦¬ ë“±) - ì—¬ê¸°ì„  ë¦¬ë·°ë§Œ í•„í„°ë§í•˜ì—¬ ë³´ì—¬ì¤Œ
        mainEl.innerHTML = `
          <section class="section">
            <h2>ë§ˆì´í˜ì´ì§€ â€” ${escapeHtml(user.name)}</h2>
            <p>ë“±ë¡ëœ ë¦¬ë·°ë¥¼ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <div id="myReviewsContainer"></div>
            <div style="margin-top:1rem;">
              <button id="btnBackToHome" class="btn-ghost">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            </div>
          </section>
        `;
        document.getElementById('btnBackToHome').addEventListener('click', () => location.hash = '#home');
        const myReviews = loadReviews().filter(r => r.email === user.email);
        const cont = document.getElementById('myReviewsContainer');
        if(myReviews.length === 0) cont.innerHTML = '<p>ì‘ì„±í•œ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        else cont.innerHTML = myReviews.map(r => `
          <div class="review-item">
            <div class="meta">${escapeHtml(r.name)} | ${new Date(r.date).toLocaleString()} | ${renderStarsStatic(r.rating)} | ${escapeHtml((PRODUCTS[r.productId] && PRODUCTS[r.productId].name) || 'ì „ì²´')}</div>
            <div>${escapeHtml(r.comment)}</div>
          </div>
        `).join('');
      });

      authArea.appendChild(nameEl);
      authArea.appendChild(btnProfile);
      authArea.appendChild(btnLogout);
    } else {
      const btnLogin = document.createElement('button');
      btnLogin.className = 'btn-auth';
      btnLogin.id = 'btnLoginTop';
      btnLogin.textContent = 'ë¡œê·¸ì¸';
      btnLogin.addEventListener('click', () => openAuthModal('login'));
      const btnRegister = document.createElement('button');
      btnRegister.className = 'btn-auth';
      btnRegister.id = 'btnRegisterTop';
      btnRegister.textContent = 'íšŒì›ê°€ì…';
      btnRegister.addEventListener('click', () => openAuthModal('register'));
      authArea.appendChild(btnLogin);
      authArea.appendChild(btnRegister);
    }
  }

  /* -----------------------------
     ëª¨ë‹¬ ì œì–´ (ë¡œê·¸ì¸/íšŒì›ê°€ì…)
     ----------------------------- */
  const modalBackdrop = document.getElementById('modalBackdrop');
  const authModal = document.getElementById('authModal');

  function closeModal() {
    modalBackdrop.classList.add('hidden');
    authModal.innerHTML = '';
  }

  function openAuthModal(mode='login'){
    // mode: 'login' or 'register'
    modalBackdrop.classList.remove('hidden');
    buildAuthModal(mode);
  }

  modalBackdrop.addEventListener('click', (e) => {
    if(e.target === modalBackdrop) closeModal();
  });

  function buildAuthModal(mode){
    if(mode === 'login'){
      authModal.innerHTML = `
        <h3>ë¡œê·¸ì¸</h3>
        <form id="loginForm" class="row">
          <input type="email" id="loginEmail" placeholder="ì´ë©”ì¼" required />
          <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" required />
          <div class="actions">
            <button type="button" id="openRegisterFromLogin" class="btn-ghost">íšŒì›ê°€ì…</button>
            <button type="submit" class="btn-primary btn-auth">ë¡œê·¸ì¸</button>
            <button type="button" id="closeModalBtn" class="btn-auth">ì·¨ì†Œ</button>
          </div>
        </form>
      `;
      document.getElementById('closeModalBtn').addEventListener('click', closeModal);
      document.getElementById('openRegisterFromLogin').addEventListener('click', () => buildAuthModal('register'));
      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value.trim().toLowerCase();
        const password = document.getElementById('loginPassword').value;
        if(!email || !password){ alert('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
        const users = loadUsers();
        const user = users.find(u => u.email === email);
        if(!user){ alert('ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤. íšŒì›ê°€ì… í•´ì£¼ì„¸ìš”.'); return; }
        const hashed = await hashPassword(password);
        if(hashed !== user.passHash){ alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
        // ë¡œê·¸ì¸ ì„±ê³µ
        setCurrentUser({ email: user.email, name: user.name });
        alert(`${user.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.`);
        closeModal();
        // if there was pending scroll etc, trigger route to re-render forms with name
        handleRoute();
      });
    } else {
      authModal.innerHTML = `
        <h3>íšŒì›ê°€ì…</h3>
        <form id="registerForm" class="row">
          <input type="text" id="registerName" placeholder="ì´ë¦„" required />
          <input type="email" id="registerEmail" placeholder="ì´ë©”ì¼" required />
          <input type="password" id="registerPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)" required />
          <input type="password" id="registerPassword2" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required />
          <div class="actions">
            <button type="button" id="openLoginFromRegister" class="btn-ghost">ë¡œê·¸ì¸</button>
            <button type="submit" class="btn-primary btn-auth">íšŒì›ê°€ì…</button>
            <button type="button" id="closeModalBtn2" class="btn-auth">ì·¨ì†Œ</button>
          </div>
        </form>
      `;
      document.getElementById('closeModalBtn2').addEventListener('click', closeModal);
      document.getElementById('openLoginFromRegister').addEventListener('click', () => buildAuthModal('login'));
      document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('registerName').value.trim();
        const email = document.getElementById('registerEmail').value.trim().toLowerCase();
        const pw = document.getElementById('registerPassword').value;
        const pw2 = document.getElementById('registerPassword2').value;
        if(!name || !email || !pw){ alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.'); return; }
        if(pw.length < 6){ alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'); return; }
        if(pw !== pw2){ alert('ë¹„ë°€ë²ˆí˜¸ì™€ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
        const users = loadUsers();
        if(users.some(u => u.email === email)){ alert('ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.'); return; }
        const passHash = await hashPassword(pw);
        users.push({ name, email, passHash, created: new Date().toISOString() });
        saveUsers(users);
        alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.');
        buildAuthModal('login');
      });
    }
  }

  /* -----------------------------
     UI í…œí”Œë¦¿ ìƒì„± í•¨ìˆ˜ë“¤ (ê¸°ì¡´ ì½”ë“œ ê¸°ë°˜)
     ----------------------------- */
  const mainEl = document.getElementById('main');

  function getHomeHTML(){
    return `
      <section class="home-section intro-section">
        <div class="intro-text">
          <h2>ë°”íˆ¬ ì†ŒíŒŒ ì†Œê°œ</h2>
          <p>37ë…„ ì¥ì¸ì˜ ì†ê¸¸ì´ ë‹´ê¸´ ìµœê³ ì˜ ì†ŒíŒŒ ë¸Œëœë“œ, ë°”íˆ¬ ì†ŒíŒŒì…ë‹ˆë‹¤. í¸ì•ˆí•¨ê³¼ ë””ìì¸ì„ ëª¨ë‘ ë§Œì¡±ì‹œí‚¤ëŠ” ì œí’ˆì„ ì œê³µí•©ë‹ˆë‹¤.</p>
        </div>
        <div class="intro-image">
          <img src="intro.jpg" alt="ë°”íˆ¬ ì†ŒíŒŒ ë§¤ì¥ ì‚¬ì§„" />
        </div>
      </section>

      <section class="home-section" id="products-list">
        <h2>ì œí’ˆ ì†Œê°œ</h2>
        <div class="products">
          ${Object.values(PRODUCTS).map(p => `
            <div class="product">
              <img src="${escapeHtml(p.img)}" alt="${escapeHtml(p.name)}" />
              <div class="info">
                <h4>${escapeHtml(p.name)}</h4>
                <p>${p.price}</p>
                <button data-id="${p.id}" class="btn-detail">ìì„¸íˆ ë³´ê¸°</button>
              </div>
            </div>
          `).join('')}
        </div>
      </section>

      <section class="home-section youtube-section">
        <h2>ìœ íŠœë¸Œ ì†Œê°œ</h2>
        <!-- ìœ íŠœë¸Œ ì˜ìƒì€ ë¡œì»¬ íŒŒì¼ì—ì„œ ì œëŒ€ë¡œ ì•ˆ ë‚˜ì˜¬ ìˆ˜ ìˆìœ¼ë‹ˆ ì›¹ ì„œë²„ì—ì„œ ì—´ê¸°ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤ -->
        <iframe class="youtube-iframe" src="https://www.youtube.com/embed/gOn-i7L6swU" allowfullscreen></iframe>
        <button class="btn-youtube" id="youtubeBtn">ìœ íŠœë¸Œ ì±„ë„ ë°”ë¡œê°€ê¸°</button>
      </section>

      <section class="home-section">
        <h2>ì¸ìŠ¤íƒ€ê·¸ë¨ & ë¸”ë¡œê·¸</h2>
        <div class="social-links">
          <a href="https://www.instagram.com/batoosofa/" target="_blank" rel="noopener noreferrer" class="social-btn instagram">
            ğŸ“· Instagram
          </a>
          <a href="https://blog.naver.com/sofaman40y" target="_blank" rel="noopener noreferrer" class="social-btn blog">
            ğŸ“ Blog
          </a>
        </div>
      </section>

      <section class="home-section">
        <h2>ì‚¬ì—…ì ì •ë³´</h2>
        <p>ìƒí˜¸ëª…: ë°”íˆ¬ ì†ŒíŒŒ</p>
        <p>ëŒ€í‘œì: ì‹ í–‰ìˆ˜</p>
        <p>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: 123-45-67890</p>
        <p>ì£¼ì†Œ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ...</p>
        <p>ì „í™”: 010-1234-5678</p>
      </section>
    `;
  }

  function getProductsPageHTML(){
    return `
      <section class="home-section" id="products-list">
        <h2>ì œí’ˆ ëª©ë¡</h2>
        <div class="products">
          ${Object.values(PRODUCTS).map(p => `
            <div class="product">
              <img src="${escapeHtml(p.img)}" alt="${escapeHtml(p.name)}" />
              <div class="info">
                <h4>${escapeHtml(p.name)}</h4>
                <p>${p.price}</p>
                <button data-id="${p.id}" class="btn-detail">ìì„¸íˆ ë³´ê¸°</button>
              </div>
            </div>
          `).join('')}
        </div>
      </section>
    `;
  }

  // í†µí•© ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ (ëª¨ë“  ì œí’ˆì˜ ë¦¬ë·°ë¥¼ ë³´ì—¬ì¤Œ)
  function getReviewsHTML() {
    const reviews = loadReviews();
    if (reviews.length === 0) {
      return `<p>ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
    }
    return `
      <div class="review-list">
        ${reviews.map(r => `
          <div class="review-item">
            <div class="meta">${escapeHtml(r.name)} | ${new Date(r.date).toLocaleString()} | ${renderStarsStatic(r.rating)} | ${escapeHtml((PRODUCTS[r.productId] && PRODUCTS[r.productId].name) || 'ìƒí’ˆ ì—†ìŒ')}</div>
            <div>${escapeHtml(r.comment)}</div>
          </div>
        `).join('')}
      </div>
    `;
  }

  // ë¦¬ë·° ì…ë ¥ í¼ (productIdê°€ ìˆìœ¼ë©´ ê·¸ ìƒí’ˆì— ëŒ€í•œ ë¦¬ë·° ì‘ì„±í¼, ì—†ìœ¼ë©´ ê¸€ë¡œë²Œ í¼)
  function getReviewFormHTML(productId){
    const containerId = productId ? `starContainer-${productId}` : 'starContainer-global';
    const user = getCurrentUser();
    const nameValue = user ? escapeHtml(user.name) : '';
    const nameReadonly = user ? 'readonly' : '';
    return `
      <section class="section review-form-section">
        <h3>ë¦¬ë·° ì‘ì„±${productId ? ' â€” ' + escapeHtml(PRODUCTS[productId].name) : ''}</h3>
        <form id="reviewForm-${productId || 'global'}" data-product="${productId || ''}">
          <input type="text" id="reviewName-${productId || 'global'}" placeholder="ì´ë¦„" value="${nameValue}" ${nameReadonly} required />
          <div class="stars" id="${containerId}">
            ${[1,2,3,4,5].map(i => `<span class="star" data-value="${i}">&#9733;</span>`).join('')}
          </div>
          <textarea id="reviewComment-${productId || 'global'}" rows="4" placeholder="ë¦¬ë·° ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”." required></textarea>
          <button type="submit" class="subscribe">ë¦¬ë·° ë“±ë¡ (ë¡œê·¸ì¸ í•„ìš”)</button>
        </form>
      </section>
    `;
  }

  // ë³„ ì ìˆ˜ ì¶œë ¥ (ì½ê¸°ìš©)
  function renderStarsStatic(rating) {
    let starsHTML = '';
    for(let i=1; i<=5; i++) {
      starsHTML += `<span class="star${i <= rating ? ' selected' : ''}">&#9733;</span>`;
    }
    return starsHTML;
  }

  // ìŠ¤íƒ€ UI ì„¸íŒ…: containerId ë¬¸ìì—´ì„ ë„˜ê¸°ë©´ ê·¸ ì»¨í…Œì´ë„ˆ ë‚´ì˜ ë³„ë“¤ì— í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
  function setupStarRating(containerId){
    const container = document.getElementById(containerId);
    if(!container) return () => 0;
    const stars = Array.from(container.querySelectorAll('.star'));
    let currentRating = 0;
    stars.forEach(s => s.classList.remove('selected'));
    stars.forEach(star => {
      star.addEventListener('click', () => {
        currentRating = Number(star.dataset.value);
        stars.forEach(s => s.classList.toggle('selected', Number(s.dataset.value) <= currentRating));
      });
    });
    return () => currentRating; // ë°˜í™˜: í˜„ì¬ ì„ íƒëœ ê°’ ì½ëŠ” í•¨ìˆ˜
  }

  // ìƒì„¸ í˜ì´ì§€ ë Œë”ë§ (ìƒí’ˆë³„ ë¦¬ë·° ì‘ì„±/ë³´ê¸° ê°€ëŠ¥)
  function renderProductDetail(id){
    const p = PRODUCTS[id];
    if(!p){
      mainEl.innerHTML = '<p>ì œí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
      return;
    }
    const productReviews = loadReviews().filter(r => Number(r.productId) === Number(id));
    mainEl.innerHTML = `
      <section class="section">
        <h2>${escapeHtml(p.name)}</h2>
        <img src="${escapeHtml(p.img)}" alt="${escapeHtml(p.name)}" style="width:100%; max-width:600px; border-radius: 15px; box-shadow: 0 6px 15px rgba(0,0,0,0.15);"/>
        <p style="margin-top:1rem; font-size:1.1rem; line-height:1.5;">${escapeHtml(p.desc)}</p>
        <div style="margin-top:1rem;">
          <button id="btnBack" class="btn-ghost">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>

        <div style="margin-top:1.5rem;">
          <h3>ì´ ìƒí’ˆì˜ ë¦¬ë·°</h3>
          ${productReviews.length ? productReviews.map(r => `
            <div class="review-item">
              <div class="meta">${escapeHtml(r.name)} | ${new Date(r.date).toLocaleString()} | ${renderStarsStatic(r.rating)}</div>
              <div>${escapeHtml(r.comment)}</div>
            </div>
          `).join('') : '<p>ë“±ë¡ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'}
        </div>

        ${getReviewFormHTML(id)}
      </section>
    `;

    // ë’¤ë¡œê°€ê¸°: í™ˆìœ¼ë¡œ ì´ë™ (ìš”êµ¬ì‚¬í•­ 3)
    const backBtn = document.getElementById('btnBack');
    if(backBtn) backBtn.addEventListener('click', () => {
      location.hash = '#home';
    });

    // ìŠ¤íƒ€ ì„¸íŒ… (product-specific)
    const getRating = setupStarRating(`starContainer-${id}`);

    // ë¦¬ë·° í¼ ì œì¶œ ì²˜ë¦¬ (product-specific)
    const form = document.getElementById(`reviewForm-${id}`);
    if(form){
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const currentUser = getCurrentUser();
        if(!currentUser){
          if(confirm('ë¦¬ë·° ë“±ë¡ì€ ë¡œê·¸ì¸ í›„ì— ê°€ëŠ¥í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) openAuthModal('login');
          return;
        }
        const nameInput = document.getElementById(`reviewName-${id}`);
        const commentInput = document.getElementById(`reviewComment-${id}`);
        const name = (nameInput && nameInput.value.trim()) || '';
        const comment = (commentInput && commentInput.value.trim()) || '';
        const rating = typeof getRating === 'function' ? getRating() : 0;
        if(!name || !comment){ alert('ì´ë¦„ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        if(!rating || rating === 0){ alert('ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
        const reviews = loadReviews();
        reviews.unshift({ name, comment, rating, date: new Date().toISOString(), productId: Number(id), email: currentUser.email });
        saveReviews(reviews);
        alert('ë¦¬ë·°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        // ì¬ë Œë”ë§: ë™ì¼ ìƒí’ˆ ìƒì„¸ë¡œ ëŒì•„ê°
        renderProductDetail(id);
      });
    }
  }

  // ë¦¬ë·° í˜ì´ì§€ ë Œë”ë§ (í†µí•©ëœ ì°½ìœ¼ë¡œ ëª¨ë“  ë¦¬ë·°ë¥¼ í•œëˆˆì—)
  function renderReviewsPage() {
    mainEl.innerHTML = `
      <section>
        <h2>ê³ ê° ë¦¬ë·° (ì „ì²´)</h2>
        ${getReviewsHTML()}
        ${getReviewFormHTML()} <!-- ê¸€ë¡œë²Œ ë¦¬ë·° í¼ (ì œí’ˆ ì„ íƒ ì—†ì´ ë“±ë¡ ê°€ëŠ¥) -->
      </section>
    `;

    // ìŠ¤íƒ€ ì„¸íŒ… (global)
    const getRating = setupStarRating('starContainer-global');

    const form = document.getElementById('reviewForm-global');
    if(form){
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const currentUser = getCurrentUser();
        if(!currentUser){
          if(confirm('ë¦¬ë·° ë“±ë¡ì€ ë¡œê·¸ì¸ í›„ì— ê°€ëŠ¥í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) openAuthModal('login');
          return;
        }
        const name = document.getElementById('reviewName-global').value.trim();
        const comment = document.getElementById('reviewComment-global').value.trim();
        const rating = typeof getRating === 'function' ? getRating() : 0;
        if(!name || !comment){ alert('ì´ë¦„ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        if(!rating || rating === 0){ alert('ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
        const reviews = loadReviews();
        reviews.unshift({ name, comment, rating, date: new Date().toISOString(), productId: null, email: currentUser.email });
        saveReviews(reviews);
        alert('ë¦¬ë·°ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        renderReviewsPage();
      });
    }
  }

  // ì—°ë½ì²˜ í˜ì´ì§€ ê°„ë‹¨íˆ
  function renderContact() {
    mainEl.innerHTML = `
      <section class="section">
        <h2>ì—°ë½ì²˜</h2>
        <p>ì´ë©”ì¼: contact@batoosofa.com</p>
        <p>ì „í™”ë²ˆí˜¸: 010-1234-5678</p>
        <p>ì£¼ì†Œ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ...</p>
      </section>
    `;
  }

  // HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
  function escapeHtml(text) {
    if (text === undefined || text === null) return '';
    return String(text).replace(/[&<>"']/g, function (m) {
      return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];
    });
  }

  // ë¼ìš°íŒ… ì²˜ë¦¬
  function handleRoute() {
    const hash = location.hash || '#home';

    // ë„¤ë¹„ active í‘œì‹œ ì´ˆê¸°í™”
    document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));

    if (hash === '#home') {
      mainEl.innerHTML = getHomeHTML();
      const homeNav = document.querySelector('nav a[href="#home"]');
      if(homeNav) homeNav.classList.add('active');

      // ì œí’ˆ ìƒì„¸ë³´ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
      document.querySelectorAll('.btn-detail').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          location.hash = `#product-${id}`;
        });
      });

      // ìœ íŠœë¸Œ ë²„íŠ¼
      const ybtn = document.getElementById('youtubeBtn');
      if(ybtn) ybtn.addEventListener('click', () => {
        window.open('https://www.youtube.com/channel/UCglzlObuRKTSHlOmI83potA', '_blank');
      });

      setupFadeIn();

      // ë§Œì•½ pendingScrollToì´ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ í•´ë‹¹ ì—˜ë¦¬ë¨¼íŠ¸ë¡œ ìŠ¤í¬ë¡¤
      if(pendingScrollTo){
        setTimeout(() => {
          const el = document.getElementById(pendingScrollTo);
          if(el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
          pendingScrollTo = null;
        }, 150); // ë Œë” í›„ ìŠ¤í¬ë¡¤
      }

    } else if (hash === '#products') {
      // ì‚¬ìš©ìê°€ '#products'ë¡œ ë°”ë¡œ ë“¤ì–´ì™”ì„ ë•Œ í™ˆì˜ ì œí’ˆ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤í•˜ë„ë¡ ë³€ê²½ ìš”êµ¬ì‚¬í•­ ë°˜ì˜
      // í™ˆ í™”ë©´ì„ ë¨¼ì € ë Œë”ë§í•˜ê³  ì œí’ˆ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
      pendingScrollTo = 'products-list';
      location.hash = '#home';

    } else if (hash.startsWith('#product-')) {
      const id = hash.split('-')[1];
      renderProductDetail(id);

    } else if (hash === '#reviews') {
      renderReviewsPage();
      const revNav = document.querySelector('nav a[href="#reviews"]');
      if(revNav) revNav.classList.add('active');

    } else if (hash === '#contact') {
      renderContact();
      const contNav = document.querySelector('nav a[href="#contact"]');
      if(contNav) contNav.classList.add('active');

    } else {
      mainEl.innerHTML = '<p>í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
    }

    // set auth area (ë¡œê·¸ì¸ ì—¬ë¶€ì— ë”°ë¼)
    renderAuthArea();

    // attach product nav click behavior: when clicking header's 'ì œí’ˆ' button, we want to go to the products section in í™ˆ
    // ensure the nav item exists
    const navProducts = document.getElementById('nav-products');
    if(navProducts){
      navProducts.removeEventListener('click', productNavHandler);
      navProducts.addEventListener('click', productNavHandler);
    }

    // attach logo click
    const logo = document.getElementById('logo');
    if(logo){
      logo.removeEventListener('click', logoClickHandler);
      logo.addEventListener('click', logoClickHandler);
    }

    // attach .btn-detail events (for dynamic pages too)
    document.querySelectorAll('.btn-detail').forEach(btn => {
      btn.removeEventListener('click', btnDetailHandler);
      btn.addEventListener('click', btnDetailHandler);
    });
  }

  function btnDetailHandler(e){
    const id = e.currentTarget.dataset.id;
    if(id) location.hash = `#product-${id}`;
  }
  function logoClickHandler(){ location.hash = '#home'; }

  function productNavHandler(e){
    e.preventDefault();
    // if currently on home, scroll to products-list directly
    if(location.hash === '#home' || location.hash === '' || location.hash === '#'){
      const el = document.getElementById('products-list');
      if(el){
        el.scrollIntoView({ behavior: 'smooth', block: 'start' });
      } else {
        // fallback: request a scroll after render
        pendingScrollTo = 'products-list';
        location.hash = '#home';
      }
    } else {
      // set pending flag so after home renders we scroll
      pendingScrollTo = 'products-list';
      location.hash = '#home';
    }
  }

  function setupFadeIn(){
    const sections = document.querySelectorAll('.home-section');
    const io = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if(entry.isIntersecting){
          entry.target.classList.add('visible');
          io.unobserve(entry.target);
        }
      });
    }, {threshold: 0.3});
    sections.forEach(s => io.observe(s));
  }

  // ì´ˆê¸° ì´ë²¤íŠ¸ ì—°ê²°
  window.addEventListener('hashchange', handleRoute);
  window.addEventListener('load', () => {
    // ì´ˆê¸° render
    handleRoute();

    // If user directly opened '#products' before load, ensure redirect
    if(location.hash === '#products'){
      pendingScrollTo = 'products-list';
      location.hash = '#home';
    }

    // attach initial buttons in header (signup/login)
    // (renderAuthArea will attach listeners; but ensure first-time buttons also)
    const btnLogin = document.getElementById('btnLogin');
    const btnReg = document.getElementById('btnRegister');
    if(btnLogin) btnLogin.addEventListener('click', () => openAuthModal('login'));
    if(btnReg) btnReg.addEventListener('click', () => openAuthModal('register'));

    // Close modal on ESC
    document.addEventListener('keydown', (e) => {
      if(e.key === 'Escape') closeModal();
    });
  });

  /* -----------------------------
     ì¶”ê°€ ìœ í‹¸ë¦¬í‹° (ì•ˆì „í•œ í…ìŠ¤íŠ¸ ë Œë”ë§ ë“±)
     ----------------------------- */
  // ê¸°ì¡´ í•¨ìˆ˜ renderStarsStatic, escapeHtml ì´ë¯¸ ì •ì˜ above

  // ensure nav active state is set when clicking nav links
  document.addEventListener('click', (e) => {
    if(e.target.matches('nav a.nav-link')){
      // let the hashchange handler deal with rendering; but we can mark active
      setTimeout(() => {
        document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
        const a = e.target;
        if(a) a.classList.add('active');
      }, 20);
    }
  });

  // Expose a couple helpers for debugging if needed (not required)
  window._batoo = {
    loadUsers, saveUsers, loadReviews, saveReviews, getCurrentUser
  };

  // render auth area immediately
  renderAuthArea();

</script>

</body>

</html>
